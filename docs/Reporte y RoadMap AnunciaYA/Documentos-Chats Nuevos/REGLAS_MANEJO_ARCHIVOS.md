# üîí REGLAS ESTRICTAS - Manejo de Archivos

**Proyecto:** AnunciaYA v3.0  
**Fecha:** 07 Enero 2026  
**Estas reglas son OBLIGATORIAS y est√°n guardadas en mi memoria permanente**

---

## üö® REGLA PRINCIPAL

### **NUNCA generar archivos >100 l√≠neas sin seguir este flujo:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Usuario solicita crear/modificar archivo       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ ¬øTiene >100 l√≠neas? ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ           ‚îÇ
             NO          S√ç
              ‚îÇ           ‚îÇ
              ‚îÇ           ‚ñº
              ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ   ‚îÇ PREGUNTAR PRIMERO:   ‚îÇ
              ‚îÇ   ‚îÇ "¬øEste archivo ya    ‚îÇ
              ‚îÇ   ‚îÇ  existe?"            ‚îÇ
              ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ         ‚îÇ            ‚îÇ
              ‚îÇ        S√ç           NO
              ‚îÇ         ‚îÇ            ‚îÇ
              ‚îÇ         ‚ñº            ‚ñº
              ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ   ‚îÇ Pedir    ‚îÇ  ‚îÇ Confirmar  ‚îÇ
              ‚îÇ   ‚îÇ archivo  ‚îÇ  ‚îÇ que es     ‚îÇ
              ‚îÇ   ‚îÇ actual   ‚îÇ  ‚îÇ NUEVO      ‚îÇ
              ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ        ‚îÇ              ‚îÇ
              ‚îÇ        ‚ñº              ‚îÇ
              ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
              ‚îÇ   ‚îÇ   Usar   ‚îÇ       ‚îÇ
              ‚îÇ   ‚îÇstr_replace‚îÇ      ‚îÇ
              ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
              ‚îÇ                      ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ Generar      ‚îÇ
                 ‚îÇ archivo      ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚úÖ FLUJO OBLIGATORIO (Archivos >100 l√≠neas)

### Paso 1: **SIEMPRE Preguntar Primero**

**‚ùå INCORRECTO (lo que NO debo hacer):**
```
Usuario: "Crea PasoImagenes.tsx completo con useOptimisticUpload"

Claude: [Genera 900 l√≠neas de c√≥digo]
```

**‚úÖ CORRECTO (lo que S√ç debo hacer):**
```
Usuario: "Crea PasoImagenes.tsx completo con useOptimisticUpload"

Claude: "Antes de generar este archivo, d√©jame verificar:

¬øEl archivo PasoImagenes.tsx ya existe en tu proyecto?

- Si S√ç ‚Üí Comp√°rteme el archivo actual para hacer solo 
  los cambios necesarios con str_replace
  
- Si NO ‚Üí Confirmo que es un archivo completamente nuevo
  y lo genero desde cero

¬øCu√°l es el caso?"
```

---

### Paso 2: **Si el Archivo EXISTE ‚Üí Pedir y Modificar**

```
Usuario: "S√≠, ya existe en /apps/web/src/pages/..."

Claude: "Perfecto, comp√°rteme el archivo actual 
PasoImagenes.tsx para hacer los cambios preservando 
tu c√≥digo existente."

[Usuario comparte archivo]

Claude: [Usa str_replace para cambios quir√∫rgicos]
```

**Ventajas:**
- ‚úÖ Preserva comentarios personales
- ‚úÖ Mantiene l√≥gica espec√≠fica
- ‚úÖ Respeta formato del usuario
- ‚úÖ Cero riesgo de perder c√≥digo

---

### Paso 3: **Si el Archivo NO EXISTE ‚Üí Confirmar y Generar**

```
Usuario: "No, es un archivo completamente nuevo"

Claude: "Entendido, voy a generar PasoImagenes.tsx 
completo desde cero."

[Genera archivo nuevo]
```

---

## üö´ CASOS PROHIBIDOS

### ‚ùå **NUNCA hacer esto:**

1. **Asumir que es archivo nuevo sin preguntar**
   ```
   Usuario: "Actualiza PasoContacto.tsx"
   Claude: [Genera 800 l√≠neas sin preguntar]
   ‚ùå PROHIBIDO
   ```

2. **Generar archivo completo cuando solo necesita cambios peque√±os**
   ```
   Usuario: "Agrega validaci√≥n en el formulario"
   Claude: [Re-escribe 500 l√≠neas]
   ‚ùå PROHIBIDO - Usar str_replace
   ```

3. **Re-escribir "porque es m√°s r√°pido para m√≠"**
   ```
   Claude: "str_replace fall√≥, mejor lo re-escribo todo"
   ‚ùå PROHIBIDO - Intentar fix o preguntar
   ```

4. **Generar m√∫ltiples versiones sin confirmaci√≥n**
   ```
   Claude: "Te doy 3 opciones de c√≥digo:"
   [Opci√≥n A: 400 l√≠neas]
   [Opci√≥n B: 500 l√≠neas]
   [Opci√≥n C: 600 l√≠neas]
   ‚ùå PROHIBIDO - Preguntar qu√© necesita primero
   ```

---

## ‚öôÔ∏è USO DE `str_replace`

### Cu√°ndo Usar:
- ‚úÖ Archivos >100 l√≠neas con cambios localizados
- ‚úÖ Agregar 1-10 l√≠neas en lugares espec√≠ficos
- ‚úÖ Modificar funciones existentes
- ‚úÖ Actualizar imports
- ‚úÖ Cambiar l√≥gica espec√≠fica

### C√≥mo Usar:

```typescript
// 1. Identificar el fragmento EXACTO a cambiar
old_str: "const handleSubmit = () => {
  submitForm();
}"

// 2. Reemplazar con el nuevo c√≥digo
new_str: "const handleSubmit = async () => {
  setIsLoading(true);
  await submitForm();
  setIsLoading(false);
}"
```

### Si `str_replace` Falla:

**Intentar 3 veces:**
1. Verificar line endings (CRLF vs LF)
2. Ajustar espaciado/indentaci√≥n
3. Usar fragmento m√°s peque√±o

**Si sigue fallando:**
```
Claude: "str_replace fall√≥ despu√©s de 3 intentos por [raz√≥n].

Opciones:
A) Que t√∫ hagas el cambio manualmente (te digo qu√© cambiar)
B) Copiar archivo, convertir line endings, retry
C) Re-escribir completo (RIESGOSO - pierdes tu c√≥digo)

¬øCu√°l prefieres?"
```

---

## üìè TABLA DE DECISIONES R√ÅPIDAS

| Situaci√≥n | L√≠neas | Acci√≥n Correcta |
|-----------|--------|-----------------|
| Archivo nuevo confirmado | Cualquiera | Generar completo |
| Archivo existe, cambio peque√±o | <100 | str_replace |
| Archivo existe, cambio peque√±o | >100 | str_replace |
| Archivo existe, cambio grande | >100 | str_replace m√∫ltiple |
| No s√© si existe | >100 | **PREGUNTAR PRIMERO** |
| Usuario dice "actualiza X" | >100 | **PREGUNTAR si existe** |
| Usuario dice "crea X completo" | >100 | **PREGUNTAR si existe** |

---

## üí° FRASES CLAVE QUE DEBO DETECTAR

Cuando el usuario dice:

| Frase del Usuario | Mi Respuesta Correcta |
|-------------------|----------------------|
| "Crea/actualiza [archivo].tsx" | "¬øEste archivo ya existe?" |
| "Modifica el componente X" | "¬øEste archivo ya existe?" |
| "Genera [archivo] completo" | "¬øEste archivo ya existe?" |
| "Agrega funcionalidad a Y" | "¬øEste archivo ya existe?" |
| "Refactoriza [archivo]" | "Comp√°rteme el archivo actual" |

**Si dice "NUEVO" expl√≠citamente:**
```
Usuario: "Crea un NUEVO componente HeaderV2.tsx"
Claude: ‚úÖ Puedo generar completo (es nuevo confirmado)
```

---

## üéØ EJEMPLOS COMPLETOS

### ‚úÖ Ejemplo CORRECTO 1:

```
Usuario: "Actualiza TabContacto.tsx para agregar 
validaci√≥n de email"

Claude: "Antes de hacer los cambios, ¬øel archivo 
TabContacto.tsx ya existe en tu proyecto?

Si S√ç ‚Üí Comp√°rtelo para usar str_replace
Si NO ‚Üí Lo genero nuevo completo"

Usuario: "S√≠ existe, aqu√≠ est√°: [comparte archivo]"

Claude: [Usa str_replace para agregar validaci√≥n]
‚úÖ Preserv√≥ todo el c√≥digo existente
```

---

### ‚úÖ Ejemplo CORRECTO 2:

```
Usuario: "Necesito un nuevo componente ModalConfirmacion.tsx 
con botones Aceptar/Cancelar"

Claude: "¬øEste componente ya existe en tu proyecto o 
es completamente nuevo?"

Usuario: "Es nuevo"

Claude: "Perfecto, genero ModalConfirmacion.tsx 
completo desde cero."
‚úÖ Confirm√≥ que es nuevo antes de generar
```

---

### ‚ùå Ejemplo INCORRECTO:

```
Usuario: "Actualiza PasoHorarios.tsx para agregar toggle 
de 24 horas"

Claude: [Genera 800 l√≠neas completas sin preguntar]

‚ùå Debi√≥ preguntar si existe primero
‚ùå Debi√≥ pedir el archivo
‚ùå Debi√≥ usar str_replace
```

---

## üîê COMPROMISO PERMANENTE

**Esta regla est√° guardada en mi memoria permanente.**

En **TODAS** las conversaciones (actuales y futuras):
- ‚úÖ Preguntar√© SIEMPRE antes de generar archivos >100 l√≠neas
- ‚úÖ Usar√© str_replace como m√©todo principal
- ‚úÖ Preservar√© tu c√≥digo existente
- ‚úÖ No asumir√© que algo es nuevo sin confirmar

**Si violo esta regla:**
- Recu√©rdamela mostrando este documento
- Es un error M√çO, no tuyo
- Me comprometo a corregirlo inmediatamente

---

## üìå RESUMEN EN 3 PUNTOS

1. **Archivo >100 l√≠neas ‚Üí PREGUNTAR: "¬øYa existe?"**
2. **Si existe ‚Üí PEDIR archivo y usar str_replace**
3. **Si no existe ‚Üí CONFIRMAR que es nuevo antes generar**

---

**Documento guardado:** `/docs/REGLAS_MANEJO_ARCHIVOS.md`  
**Fecha de creaci√≥n:** 07 Enero 2026  
**√öltima actualizaci√≥n:** 07 Enero 2026  
**Estado:** ACTIVO Y OBLIGATORIO
